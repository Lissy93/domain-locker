<!-- src/app/pages/domains/add.page.html -->
<div class="card add-domain-wrap">
  <h2>Add New Domain</h2>
  <p-steps [model]="[{label: 'Domain Name'}, {label: 'Domain Details'}, {label: 'Confirm'}]" [activeIndex]="activeIndex"></p-steps>
  
  <p-message *ngIf="errorMessage" severity="error" [text]="errorMessage"></p-message>

  <form [formGroup]="domainForm" (ngSubmit)="onSubmit()" (keydown.enter)="onEnterKey($event)">
    <p-card>
      <ng-container [ngSwitch]="activeIndex">
        <!-- Step 1: Domain Name -->
        <div *ngSwitchCase="0">
          <div class="field">
            <label for="domainName">
              Domain Name
              <small>Enter the domain name you want to track</small>
            </label>
            <div class="input-wrap">
              <input pInputText
                id="domainName"
                type="text"
                formControlName="domainName"
                aria-describedby="Input field for domain name to add"
              >
              <small class="p-error" *ngIf="domainForm.get('domainName').invalid && domainForm.get('domainName').touched">
                Please enter a valid domain name.
              </small>
              <small class="p-success text-green-400" *ngIf="!domainForm.get('domainName').invalid && domainForm.get('domainName').touched">
                Looks good! Click Next to continue.
              </small>
            </div>
          </div>
          <div class="button-wrap single">
            <button pButton type="button" label="Next" (click)="onNextStep()" [disabled]="domainForm.get('domainName').invalid"></button>
          </div>
        </div>

        <!-- Step 2: Domain Details -->
        <div *ngSwitchCase="1" class="space-y-4">
          <div class="field">
            <label for="registrar">
              Registrar
              <small>The company that the domain was registered with</small>
            </label>
            <div class="input-wrap">
              <input id="registrar" type="text" pInputText formControlName="registrar" class="w-full">
            </div>
          </div>
          <div class="field">
            <label for="expiryDate">
              Expiry Date
              <small>This is the date when the domain must be renewed by</small>
            </label>
            <div class="input-wrap">
              <p-calendar id="expiryDate" formControlName="expiryDate" [inputStyle]="{'width':'100%'}"></p-calendar>
            </div>
          </div>
          <div class="field">
            <label for="tags">
              Tags
              <small>Comma separated list of tags to categorise the domain</small>
            </label>
            <div class="input-wrap">
              <p-chips id="tags" formControlName="tags" separator="," [addOnBlur]="true"></p-chips>
              <small class="p-error" *ngIf="domainForm.get('tags').errors">{{ getTagsErrorMessage() }}</small>
            </div>
          </div>

          <div class="field">
            <label for="notes">
              Notes
              <small>Any additional notes you want to add</small>
            </label>
            <div class="input-wrap">
              <textarea 
                id="notes"
                rows="3"
                pInputTextarea 
                [autoResize]="true"
                formControlName="notes"
                class="w-full"
                maxlength="255"></textarea>
              <small class="p-error" *ngIf="domainForm.get('notes').errors">{{ getNotesErrorMessage() }}</small>
            </div>
          </div>
          
          <p-inplace>
            <ng-template pTemplate="display">
              <div class="inline-flex items-center my-4">
                  <span class="pi pi-paperclip align-middle"></span>
                  <span class="ml-2">View Domain Data</span>
              </div>
            </ng-template>
            <ng-template pTemplate="content">
              <div class="p-2 rounded-sm p-0.5 mb-4" style="background: var(--surface-100);">
                <h3 class="text-lg font-semibold m-0 mb-4">Domain Information</h3>
                <p-table 
                  [value]="tableData" 
                  styleClass="p-datatable-sm p-datatable-gridlines w-full"
                  [tableStyle]="{'table-layout': 'fixed'}"
                  scrollHeight="400px"
                >
                  <ng-template pTemplate="header">
                    <tr>
                      <th class="w-1/3 p-2 font-semibold text-sm">Property</th>
                      <th class="w-2/3 p-2 font-semibold text-sm">Value</th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-item>
                    <tr>
                      <td class="w-1/3 p-2 font-medium break-words bg-transparent text-sm">{{item.key}}</td>
                      <td class="w-2/3 p-2 break-words bg-transparent text-sm">{{item.value}}</td>
                    </tr>
                  </ng-template>
                </p-table>
            </div>
            </ng-template>
          </p-inplace>

          <div class="button-wrap">
            <button pButton type="button" label="Previous" (click)="onPreviousStep()" class="p-button-secondary"></button>
            <button pButton type="button" label="Next" (click)="onNextStep()" [disabled]="domainForm.invalid"></button>
          </div>
        </div>

        <!-- Step 3: Confirm -->
        <div *ngSwitchCase="2">
          <h3>Please confirm your domain details:</h3>
          <p><strong>Domain Name:</strong> {{ domainForm.get('domainName')?.value }}</p>
          <p><strong>Registrar:</strong> {{ domainForm.get('registrar')?.value }}</p>
          <p><strong>Expiry Date:</strong> {{ domainForm.get('expiryDate')?.value | date:'mediumDate' }}</p>
          <p><strong>Tags:</strong> {{ domainForm.get('tags')?.value?.join(', ') }}</p>
          
          <div class="button-wrap">
            <button pButton type="button" label="Previous" (click)="onPreviousStep()" class="p-button-secondary"></button>
            <button pButton type="submit" label="Save"></button>
          </div>
        </div>
      </ng-container>
    </p-card>
  </form>
</div>
