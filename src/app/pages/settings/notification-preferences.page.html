<h2 class="text-2xl font-semibold my-2">Notification Preferences</h2>
<p class="italic text-lg opacity-70 m-0">
  Configure how you would like to receive notifications and alerts.
</p>
<p class="italic opacity-70 m-0">
  Note: You can update which notifications you receive on a per-domain basis by editing the domain.
</p>
<form [formGroup]="notificationForm" *ngIf="notificationForm" class="space-y-6">
  <p-card *ngFor="let channel of notificationChannels" [formGroupName]="channel.formControlName" class="notification-section p-4 shadow-sm rounded-lg">
    <div class="flex items-center justify-between">
      <h3 class="font-semibold text-lg m-0">{{ channel.name }}</h3>
      <p-toggleButton
        formControlName="enabled"
        onLabel="Enabled"
        offLabel="Disabled"
        [onIcon]="'pi pi-check-circle'"
        offIcon="pi pi-minus-circle"
        [style]="{
          'background-color': notificationForm.get(channel.formControlName + '.enabled')?.value ? 'var(--green-400)' : 'var(--red-400)'
        }"
        class="ml-auto"
      ></p-toggleButton>
    </div>

    <div *ngIf="notificationForm.get(channel.formControlName + '.enabled')?.value" class="mt-3 space-y-4">
      <div *ngIf="channel.requires">
        <div *ngFor="let field of channel.requires">
          <label [for]="field.name" class="block text-sm font-medium mb-1">{{ field.label }}</label>
          <input
            pInputText
            [formControlName]="field.name"
            [id]="field.name"
            [placeholder]="field.placeholder"
            class="w-full"
          />
          <small *ngIf="notificationForm.get(channel.formControlName + '.' + field.name)?.invalid && notificationForm.get(channel.formControlName + '.' + field.name)?.touched" class="p-error">
            {{ field.label }} is required
          </small>
        </div>
      </div>

      <!-- Webhook providers section -->
      <div *ngIf="channel.providers" class="space-y-4">
        <label class="block text-sm font-medium">Provider</label>
        <div class="flex flex-wrap gap-4">
          <p-radioButton
            *ngFor="let provider of channel.providers"
            [value]="provider.value"
            formControlName="provider"
            [label]="provider.label"
          ></p-radioButton>
        </div>

        <!-- Conditional fields based on selected provider -->
        <div *ngFor="let provider of channel.providers">
          <div *ngIf="notificationForm.get(channel.formControlName + '.provider')?.value === provider.value" class="mt-3 space-y-3">
            <div *ngFor="let field of provider.fields">
              <label [for]="field.name" class="block text-sm font-medium mb-1">{{ field.label }}</label>
              <input
                pInputText
                [formControlName]="field.name"
                [id]="field.name"
                [placeholder]="field.placeholder"
                class="w-full"
              />
              <small *ngIf="notificationForm.get(channel.formControlName + '.' + field.name)?.invalid && notificationForm.get(channel.formControlName + '.' + field.name)?.touched" class="p-error">
                {{ field.label }} is required
              </small>
            </div>
          </div>
        </div>
      </div>

    </div>
  </p-card>
</form>
